# はじめてのAndroidプロジェクト

## 原則

 Android開発では、原則として一つのアプリが Android Studioの一つのプロジェクトという形態をとっている。

Android Studioはプロジェクト作成時に、バックグラウンドでインターネットへのアクセスを行い、必要な情報を取得したり、ライブラリを自動でダウンロードするようになっている。

そのため、オフラインでの環境下では間違いなくプロジェクト作成に失敗する。

## Empty Activity画面

この画面ではプロジェクトに必要な最低限の情報を入力する。

### Name

**この名前はアプリ名ではなくプロジェクト名であること。**

こっこはプロジェクト名なのでアルファベットのアッパーキャメルケースで記述する。

Android端末のホーム画面で表示されるアプリ名はstrings.xmlで設定が可能。

### Package name

AndroidアプリではそのアプリのルートとなるJavaパッケージを指定することになっている。

アプリ内の Kotlinファイルはそのルートパッケージ配下に作成する必要がある。

同一ルートパッケージのアプリは一つの端末には1つしかインストールできない仕組みになっている。

Android OSは、アプリの認識をプロジェクト名でもなくこのルートパッケージで行うためである。

そのため、アプリを作成する場合このルートパッケージを何にするかは重要な設計情報である。

**通常ルートパッケージはそのアプリを開発する会社所有のドメインを逆順にしたものを基点として、そこにプロジェクト名を加えた形で作成する。**

**Javaクラスの一意性**

Javaでは、作成したクラスが世界中で一意になるように名前をつける慣習がある。その際単なるクラス名では一意は実現できないので、「パッケージ名+クラス名」(完全修飾名)で一意となるようにする。

### Save loation

このプロジェクトファイルを格納するフォルダ。デフォルトでは、ユーザーのホームフォルダちょっかに自動的に作成されたAndroidStudioProjectsフォルダの配下にName(プロジェクト名)と同名のフォルダが作られるようになっている。

**プロジェクトを格納するフォルダ名が、プロジェクト名と同一であれば、その親フォルダに関しては変更しても構わない。**

### Language

アプリの開発言語を選択する。Javaか Kotlinが選択できるようになっている。

### Minimum SDK

作成するアプリが動作する最小のAPIレベルを選択する。Minimum SDKを選択する際、開発者はアプリのターゲットオーディエンスと互換性を検討する必要がある。低いバージョンを設定すると、より多くのデバイスと互換性があるが、新しいAndroid機能を利用できない場合がある。逆に、高いバージョンを設定すると、最新の機能を利用できるが、古いデバイスとの互換性が失われる可能性がある。

**Use legacy [android.support](http://android.support) libraries**

Androidアプリで作成で利用するSDKにはその最初期から存在するクラス群とは別に機能拡張で追加されたクラス群(サポートライブラリ)があり、Googleは2018年に整理し標準で新たなパッケージとしてAndroidXライブラリとしてリリースしている。

このチェックボックスはあえてAndroidXを利用しないで旧来のサポートライブラリを利用する場合にチェックを入れるためのもの。
**Use legacy [android.support](http://android.support) libraries**

Androidアプリで作成で利用するSDKにはその最初期から存在するクラス群とは別に機能拡張で追加されたクラス群(サポートライブラリ)があり、Googleは2018年に整理し標準で新たなパッケージとしてAndroidXライブラリとしてリリースしている。

このチェックボックスはあえてAndroidXを利用しないで旧来のサポートライブラリを利用する場合にチェックを入れるためのもの。

## AVD(Android Virtual Devise)の作成

1.Devise Managerを選択

2.Create deviseを選択

3.phoneを選択しPixel 6 を選択しNext

4.System Image画面が表示されるので、システムイメージを選択する。

5.リストの中からTiramisuを選びNext

6.Downloadを選択するとそのシステムイメージがダウンロードされる。

7.AVD名としてPixel 6 API 33 が自動で記述される。(変更可能)

Show Advanced Settings ボタンをクリックすると詳細設定が可能

8.Enable Device Frame のチェックボックスを外したうえでFinishをクリックするとAVDが作成される。

### システムイメージとは

AVDの動作に必要なものをまとめたファイルのこと。これはAndroidのバージョン(APIレベル)やAVDを起動する環境に応じてファイルが異なる。

## AVDの初期設定

AVDの▶️アイコンをクリックすると画面右下のEmulatorツールウィンドウが表示され、その中にエミュレータが表示される。

終了させる場合はPixel 6 API 33のタブのバツをクリックすることで終了する。

別ウィンドウで表示させる場合(Mac)

Android StudioのメニューからPreferencesを選択し設定画面を表示させる。その後、左ペインからToolsを選択しEmulatorを選択してLaunch in a tool window のチェックを外すと別ウィンドウでAVDが起動するようになる。

## 言語設定

AVD作成直後はOSが英語仕様になっているためAVD作成時に言語設定を行う必要がある。

画面を上にすワイプし下の方にある。Settingsをタップする。

下までスクロールしSystem項目が表示されたらそれをタップする。

Languages & input をタップする。

Languagesをタップする。

Add a lamguageをタップする。

言語リストが表示されるので右上の虫眼鏡をクリックして表示された検索ボックスにjaと入力すると日本語が出てくるのでそれを選択する。

先ほどのLanguage設定画面に戻り日本語を右のアイコンで日本語が一番上になると日本語表記に切り替わる。

## Android Studioの画面構成

左側：ツールウィンドウ

デフォルトでProjectツールウィンドウが表示されている。Ptoject上部のタイトルバーはクリックするとドロップダウンリストになっている。このリストを選択することでProjectツールウィンドウの見え方を変更できる。デフォルトではAndroidビューとなっている。

Projectビューはファインダのファイル構成に近い形に表示されるが、Androidビューは開発で必要なファイルのみを表示するようになっている。(プロジェクト作成後にAndroidビューに自動で切り替わるが、Projectビューの表示になっている場合はプロジェクトの作成に失敗している。)

右側：エディタウィンドウ

ファイルの編集ができるようになっている。

## Androidビューのファイル構成

**manifests**

このフォルダにはAndroidManifest.xmlファイルが格納されている。AndroidManifest.xmlは、このアプリの実行に必要な設定が記述されているファイル。

**java**

このフォルダにはjavaファイルが格納されている。Kotlinのソースコードである.ktファイルもこのフォルダ内に格納されている。

androidTestやtestと記述されているのはAndroidアプリをテストするための.ktファイルおよび.javaファイルの格納先。

**res(rssources)**

Androidアプリの実行に必要なファイル類で.javaファイルや.ktファイル以外のものを格納するためのフォルダ。(リソースファイルと呼ばれる。)

drawable：画像を格納

layout：画像構成に関わる.xmlファイルを格納

mipmap：アプリのアイコンを格納

values：アプリで表示する固定文字列(string.xml)、画像のテーマ(themes.xml)、色構成　　

　　　　(colors.xml)を表す.xmlファイルなどを格納

xml：データのバックアップルールの設定ファイル(backup_rules.xml)やネットワークセキュリティ　　

　　  設定ファイル(network_security_config.xml)など、任意のリソースxmlファイルを格納

Gradle Scripts

Android Studio ではビルドシステムとしてGradkeを使用しているが、そのビルドスクリプトは目的ごとにファイルが分かれ、配置ディレクトリも分散されている。それをまとめて表示している。

画面密度に自動対応するための修飾子

resフォルダ内の拡張子[-v24][xxhdpi][-night]などの修飾子がついておりこのような画像関連ファイルはその解像度に注意を払う必要がある。Android端末には画面サイズだけではなく画面解像度や画面密度が様々であり、解像度の低い画像ファイルを画面密度が高い端末で見るとジャギーで汚い画像やアイコンになってしまう。逆に解像度の高い画像ファイルを低解像度の端末で表示させようとすると今度は処理に時間がかかってしまう。

![スクリーンショット 2024-01-31 0.24.12.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/8037be10-e9ac-450e-bf6a-d774b4438a63/1be0957a-862d-4a25-838e-d49aaa4d91ba/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-01-31_0.24.12.png)

このような問題に対応するためにAndroidには画面密度に合わせた画像ファイルを同一名で用意し、適切な修飾子のフォルダに格納しておくとOSが自動判定し、そのファイルを表示してくれる。

(例)「xxxhdpi」は、超超超高密度といわれ、画像密度が〜640dpiの画像のことを示す。これに合わせたアイコンは192px*192pxで作成することが推奨されている。

「xhdpi」は超高密度といわれ、画像密度が320dpiとなり、これに合わせたアイコンは96px*96pxとなる。

## Andoroidアプリの開発の基本手順

### レイアウトファイルとアクティビティ

Androidアプリ開発では、画像構成をXMLに、その処理をKotlinクラス(.ktファイル)に記述する。

XMLファイルをレイアウトファイル Kotlinファイルをアクティビティと呼び、Actibityクラスを継承して作る。

またAndroid Studio でEmpty Activityプロジェクトを作成すると、初期画面ようのレイアウトファイルとしてactivity_main.xmlファイルが、アクティビティとしてMainActivityクラスが自動で作成される。

strings.xmlの働き

アプリを開発していくと画面内に様々な文字列を表示させる必要が出てくる。アプリ内で使われるこれらの文字列はXMLファイルや Kotlinソースに直接記述するのではなく、原則的にres/valuesフォルダ内のstring.xmlに記述する。Androidでは他言語に対応させたい場合、別言語で記述されたstring.xmlを作成し、所定のフォルダ(例えば日本語ならvalue-ja)に入れておくだけで、Android OSの言語設定に従ってOS側で自動的にstrings.xmlを切り替えてくれる仕組みが整っているからである。

```kotlin
<resources>
<string name ="app_name">HelloAndroid</string>
</resources>
```

stringタグが一つだけ記述されている。このname属性のapp_nameの文字列がアプリ名を表す。
